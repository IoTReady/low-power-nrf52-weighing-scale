<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Smart Weighing Scale: Smart Weighing Scale</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="2" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Smart Weighing Scale
   </div>
   <!-- PROJECT BRIEF is expected to be a URL -->
   <div id="projectbrief"><a href=https://github.com/IoTReady/weighing_scale_nrf>https://github.com/IoTReady/weighing_scale_nrf</a></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Smart Weighing Scale </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> This project describes a Smart Weighing Scale with low current consumption, and hence a long battery backup.</p>
<p>One of the biggest problems with the use of weighing scales in flexible retail or industrial applications is the need to provide a source of power to a scale. This causes problems such as safety hazards with a corded scale, inflexibility of placement since the location of power sources limits where the scale can be placed, and finally the inability to function when there is a power interruption. This design eliminates these disadvanteges.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Firmware</h1>
<p>After cloning or downloading this repo find the firmware documentation here "weighing_scale_nrf/firmware/bootloader/documentation/index.html".</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Circuit</h1>
<h2><a class="anchor" id="autotoc_md3"></a>
Power Supply</h2>
<p>The nrf Based Weighing Scale operates on 3.3V, and is powered by a 3.7V Li-ion battery. We use a p-MOSFET(IRLML6401) for reverse polarity protection, and a LDO(Low Drop Out) Regulator(TPS7A0233PDBV) to get a stable 3.3V output supply.</p>
<p><img src="schem01.jpeg" alt="" class="inline"/></p>
<p><img src="schem02.jpeg" alt="" class="inline" title="battery"/></p>
<h2><a class="anchor" id="autotoc_md4"></a>
Battery Charging</h2>
<p>We use a Li-ion/Li-polymer linear battery charger IC(BQ21040) for charging the battery via a micro-USB outlet. The led indicator stops glowing when the battery is fully charged.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
nRF Module</h2>
<p><img src="schem03.jpeg" alt="" class="inline" title="image"/></p>
<p>We are using the MDBT42Q nRF52840 based module as our main MCU and BLE module. It is a very low current consuming and high performance module. It needs a 3.3V power supply, and we are using its internal DC/DC regulator which is set by connecting a 10uH and 18nH inductor at DCC and DEC4 pins as shown here. We also use an external 32.768 kHz external crystal. For programming this module we need a Segger JLink Debugger, which is available as a separate device or one could use an on-board debugger from any of the Nordic Dev-boards like PCA400, etc... We kept a few GPIOs out for future use or if need to integrate anything else with the weighing scale.</p>
<p><img src="schem04.jpeg" alt="" class="inline" title="image"/></p>
<p>To measure the battery level we use this voltage divider circuit and measure it use the on board ADC pins.</p>
<p><img src="schem05.jpeg" alt="" class="inline" title="image"/></p>
<p>Tare Button is a push button for using the tare functionality. It basically resets the displayed weight on scale back to zero. The Tare button can also be used to measure multiple items in the same container. Simply add you first item, note the weight, press Tare and you are ready to weigh your next item.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
ADC Circuit: HX711</h2>
<p><img src="schem08.jpeg" alt="" class="inline" title="image"/> For measuring the weighing scale we use a Load Cell which gives an anlog output, as the weight changes. For high accuracy we use HX711 24-bit ADC chip, which is designed specifically for industrial weighing scales and other industrial control applications.</p>
<p><img src="schem06.jpeg" alt="" class="inline" title="image"/> <img src="schem07.jpeg" alt="" class="inline" title="image"/></p>
<p>To power the HX711 we need a 5V supply, so we use a Boost regulator(LM2703) to step-up the 3.7V from the battery supply and use an LDO(LP2985-5.0) to get a stable noise free 5V supply for HX711.</p>
<p>The data from the Load Cell is received via four pins HX711_IN+, HX711_IN-, HX711_AVDD and GND. This data is processed by the ADC chip and an output is send via serial interface to the nRF module. We can control the output data rate as either 10Hz or 80Hz by controlling the HX711_RATE pin state. There is no programming needed for the internal registers. All controls to the HX711 are through the pins.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
E-Ink Display</h2>
<p><img src="schem09.jpeg" alt="" class="inline" title="image"/> <img src="schem10.jpeg" alt="" class="inline" title="image"/></p>
<p>We decided to go with an E-Ink display as it is very low power consuming, reflection resistant, and was useful for the application we were targeting. This is a 1.54" 200x200 pixel &lt;a href="<a href="https://www.e-paper-display.com/products_detail/productId=513.html">https://www.e-paper-display.com/products_detail/productId=513.html</a>"&gt;E-Ink display from Good Display.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
PCB</h1>
<p>This is what the final PCB design looks like: <img src="pcb1.jpeg" alt="" class="inline" title="front_pcb"/> <img src="pcb2.jpeg" alt="" class="inline" title="back_pcb"/> <img src="pcb3.jpeg" alt="" class="inline" title="gerber_pcb"/></p>
<h1><a class="anchor" id="autotoc_md9"></a>
Hardware Builds</h1>
<p>Hardware design files are available in the "design" sub-folder</p>
<p>We tried 3 different designs for the weighing scale project and settled with the "HX711" based design as our final.</p>
<p>So you will find the final design explained on the main page.</p>
<p>The other two designs of "LPV821" and "LTC6915" based weighing scales are also fully functional, one may have to play around with the adc functions in the firmware though.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Software Builds</h1>
<p>One can find the main application with all library files(for e-ink display, and weighing scale) in the "Application" folder.</p>
<p>To setup the Nordic SDK and bootloader files follow the links in "Bootloader" folder. Also, the "documentation" folder has some good technical data.</p>
<p>To make changes in the firmware go to "weighing_scale_nrf/firmware/application/w_scale_all/" and make necessary changes.</p>
<p>To build the output files, go to the same location and use this command to generate final output files(.hex): </p><div class="fragment"><div class="line">make release</div>
</div><!-- fragment --><p>Then use the following to flash and debug the firmware: </p><div class="fragment"><div class="line">make upload</div>
</div><!-- fragment --><p>This is a custom makefile, so make sure all Debugger setings are proper. Like, make sure the Debugge name and Serial Number are correct.</p>
<p>These can be set in this <a href="https://github.com/IoTReady/weighing_scale_nrf/blob/master/firmware/application/w_scale_all/Makefile">makefile</a>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://iotready.co"> IoTReady </a><img class="footer" src="logo.png" width="30" height="30" alt="IoTReady"/></a></li>
  </ul>
</div>
</body>
</html>
