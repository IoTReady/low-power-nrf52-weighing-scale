<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Smart Weighing Scale: BLE LESC module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="2" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Smart Weighing Scale
   </div>
   <!-- PROJECT BRIEF is expected to be a URL -->
   <div id="projectbrief"><a href=https://github.com/IoTReady/weighing_scale_nrf>https://github.com/IoTReady/weighing_scale_nrf</a></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__ble__lesc.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">BLE LESC module</div>  </div>
</div><!--header-->
<div class="contents">

<p>Module for handling LESC DHKey requests.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga19d9bbb67fb87ad80231d17c2ec8e989"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ble__ipsp__errors.html#gaf6c20fb483036617204f12e99e0b997b">ret_code_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__lesc.html#ga19d9bbb67fb87ad80231d17c2ec8e989">ble_lesc_init</a> (void)</td></tr>
<tr class="memdesc:ga19d9bbb67fb87ad80231d17c2ec8e989"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to initialize the ble_lesc module.  <a href="group__ble__lesc.html#ga19d9bbb67fb87ad80231d17c2ec8e989">More...</a><br /></td></tr>
<tr class="separator:ga19d9bbb67fb87ad80231d17c2ec8e989"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga137fc2ab00946e3a13dac92213420e13"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ble__ipsp__errors.html#gaf6c20fb483036617204f12e99e0b997b">ret_code_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__lesc.html#ga137fc2ab00946e3a13dac92213420e13">ble_lesc_ecc_keypair_generate_and_set</a> (void)</td></tr>
<tr class="memdesc:ga137fc2ab00946e3a13dac92213420e13"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to generate a ECC key pair to use in LESC.  <a href="group__ble__lesc.html#ga137fc2ab00946e3a13dac92213420e13">More...</a><br /></td></tr>
<tr class="separator:ga137fc2ab00946e3a13dac92213420e13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa5c812440a30eabba750a5297898112d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ble__ipsp__errors.html#gaf6c20fb483036617204f12e99e0b997b">ret_code_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__lesc.html#gaa5c812440a30eabba750a5297898112d">ble_lesc_ecc_local_public_key_get</a> (<a class="el" href="structble__gap__lesc__p256__pk__t.html">ble_gap_lesc_p256_pk_t</a> const **pp_lesc_public_key)</td></tr>
<tr class="memdesc:gaa5c812440a30eabba750a5297898112d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to get the current LESC ECC local public key.  <a href="group__ble__lesc.html#gaa5c812440a30eabba750a5297898112d">More...</a><br /></td></tr>
<tr class="separator:gaa5c812440a30eabba750a5297898112d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac53dee04e3e6b55c77daf6774a7693ac"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ble__ipsp__errors.html#gaf6c20fb483036617204f12e99e0b997b">ret_code_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ble__lesc.html#gac53dee04e3e6b55c77daf6774a7693ac">ble_lesc_service_request_handler</a> (void)</td></tr>
<tr class="memdesc:gac53dee04e3e6b55c77daf6774a7693ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to service LESC ECDH calculations.  <a href="group__ble__lesc.html#gac53dee04e3e6b55c77daf6774a7693ac">More...</a><br /></td></tr>
<tr class="separator:gac53dee04e3e6b55c77daf6774a7693ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Module for handling LESC DHKey requests. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga137fc2ab00946e3a13dac92213420e13"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga137fc2ab00946e3a13dac92213420e13">&#9670;&nbsp;</a></span>ble_lesc_ecc_keypair_generate_and_set()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ble__ipsp__errors.html#gaf6c20fb483036617204f12e99e0b997b">ret_code_t</a> ble_lesc_ecc_keypair_generate_and_set </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to generate a ECC key pair to use in LESC. </p>
<p>This function initializes the crypto system by calling nrf_crypto_init and nrf_crypto_rng_init before calling the required functions to generate the ECC key pair. If the key generation was successful this function sets the LESC local public key in peer manager by calling <a class="el" href="group__peer__manager.html#gab69b5939738b54f1df6b2209a19397da">pm_lesc_public_key_set</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Run <a class="el" href="group__ble__lesc.html#ga19d9bbb67fb87ad80231d17c2ec8e989">ble_lesc_init</a> before calling this API.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>Generating ECC key pair was successful. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Any error code form <a class="el" href="group__nrf__crypto__ecc.html#ga3f81d85351bf50c8dcd07a87cb7c6e26">nrf_crypto_ecc_key_pair_generate</a>. </dd>
<dd>
Any error code from <a class="el" href="group__nrf__crypto__ecc.html#gafdfc93d7e5d4c03a4412228428761af7">nrf_crypto_ecc_public_key_to_raw</a>. </dd>
<dd>
Any error code from <a class="el" href="group__nrf__crypto__ecc.html#gabedfa4cd51adab448cd4c90953082429">nrf_crypto_ecc_byte_order_invert</a>. </dd>
<dd>
Any error code reported by <a class="el" href="group__peer__manager.html#gab69b5939738b54f1df6b2209a19397da">pm_lesc_public_key_set</a>. </dd></dl>

</div>
</div>
<a id="gaa5c812440a30eabba750a5297898112d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa5c812440a30eabba750a5297898112d">&#9670;&nbsp;</a></span>ble_lesc_ecc_local_public_key_get()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ble__ipsp__errors.html#gaf6c20fb483036617204f12e99e0b997b">ret_code_t</a> ble_lesc_ecc_local_public_key_get </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structble__gap__lesc__p256__pk__t.html">ble_gap_lesc_p256_pk_t</a> const **&#160;</td>
          <td class="paramname"><em>pp_lesc_public_key</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to get the current LESC ECC local public key. </p>
<p>This function gets the current ECC local public key used LESC pairing procedure the format of this key is in a type usable by peer manager, NFC (OOB) and SoftDevice.</p>
<dl class="section note"><dt>Note</dt><dd>Run <a class="el" href="group__ble__lesc.html#ga137fc2ab00946e3a13dac92213420e13">ble_lesc_ecc_keypair_generate_and_set</a> before calling this function.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>Getting the local public key was successful. </td></tr>
    <tr><td class="paramname">NRF_ERROR_NULL</td><td>pp_lesc_public_key was NULL. </td></tr>
    <tr><td class="paramname">NRF_ERROR_INVALID_STATE</td><td>No ECC keypair was generated prior to this call </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga19d9bbb67fb87ad80231d17c2ec8e989"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga19d9bbb67fb87ad80231d17c2ec8e989">&#9670;&nbsp;</a></span>ble_lesc_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ble__ipsp__errors.html#gaf6c20fb483036617204f12e99e0b997b">ret_code_t</a> ble_lesc_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to initialize the ble_lesc module. </p>
<p>This function initializes the nrf_crypto for key generation and ECDH calculations.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>Initalization was successful. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Any error code reported by <a class="el" href="group__nrf__crypto__initialization.html#gaf527041b3a9f57a73a516901e2968721">nrf_crypto_init</a>. </dd>
<dd>
Any error code reported by <a class="el" href="group__nrf__crypto__rng.html#ga23f7264b20c87593ca00b82692ff0ea0">nrf_crypto_rng_init</a>. </dd></dl>

</div>
</div>
<a id="gac53dee04e3e6b55c77daf6774a7693ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac53dee04e3e6b55c77daf6774a7693ac">&#9670;&nbsp;</a></span>ble_lesc_service_request_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ble__ipsp__errors.html#gaf6c20fb483036617204f12e99e0b997b">ret_code_t</a> ble_lesc_service_request_handler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to service LESC ECDH calculations. </p>
<p>This function will calculate a LESC ECDH key (also known as shared secret) as long as <a class="el" href="group___b_l_e___g_a_p___e_n_u_m_e_r_a_t_i_o_n_s.html#ggada486dd3c0cce897b23a887bed284fefa353a9317dd2d546b68cd872bc610db7f">BLE_GAP_EVT_LESC_DHKEY_REQUEST</a> event has been received from SoftDevice.</p>
<dl class="section note"><dt>Note</dt><dd>This function should be run in a low interrupt priority like an idle-loop in the main application context.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Any error code reported by this function that is not <a class="el" href="group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a> is critical and should be handled by aborting all ongoing BLE operations and resetting the device. Failure to do is a security risk.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>Service operation was successful. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Any other error code than NRF_SUCCESS which indicates that the device is in a critical state and must be restarted. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://iotready.co"> IoTReady </a><img class="footer" src="logo.png" width="30" height="30" alt="IoTReady"/></a></li>
  </ul>
</div>
</body>
</html>
